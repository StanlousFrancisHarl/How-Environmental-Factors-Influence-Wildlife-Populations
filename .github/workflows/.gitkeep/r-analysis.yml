name: R Analysis

on:
  push:
    paths:
      - "analysis/**"
      - "data/**"
  pull_request:
    paths:
      - "analysis/**"
      - "data/**"

jobs:
  correlation:
    if: contains(github.event.head_commit.message, 'correlation') || contains(join(github.event.commits.*.modified, ','), 'analysis/correlation_analysis.R') || contains(join(github.event.commits.*.modified, ','), 'data/R_factor_data.csv')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.2'
      - run: mkdir -p output
      - run: Rscript analysis/correlation_analysis.R
      - name: Upload correlation results
        uses: actions/upload-artifact@v3
        with:
          name: correlation-results
          path: output/

  factor:
    if: contains(github.event.head_commit.message, 'factor') || contains(join(github.event.commits.*.modified, ','), 'analysis/factor_analysis.R') || contains(join(github.event.commits.*.modified, ','), 'data/R_factor_data.csv')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.2'
      - run: mkdir -p output
      - run: Rscript analysis/factor_analysis.R
      - name: Upload factor results
        uses: actions/upload-artifact@v3
        with:
          name: factor-results
          path: output/

  survival:
    if: contains(github.event.head_commit.message, 'survival') || contains(join(github.event.commits.*.modified, ','), 'analysis/survival_analysis.R') || contains(join(github.event.commits.*.modified, ','), 'data/R_survival_data.csv')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.2'
      - run: mkdir -p output
      - run: Rscript analysis/survival_analysis.R
      - name: Upload survival results
        uses: actions/upload-artifact@v3
        with:
          name: survival-results
          path: output/
